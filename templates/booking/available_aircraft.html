
{% extends 'base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}Available Aircraft - {{ departure_airport.name }} to {{ arrival_airport.name }}{% endblock %}


{% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --primary-color: #2c3e50;
  --secondary-color: #3498db;
  --accent-color: #e74c3c;
  --success-color: #27ae60;
  --warning-color: #f39c12;
  --light-bg: #f8f9fa;
  --border-color: #dee2e6;
  --text-muted: #6c757d;
  --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
  --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
}

.search-summary {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  padding: 2rem 0;
  margin-bottom: 2rem;
}

.search-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

.search-detail-item {
  text-align: center;
  padding: 1rem;
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
  backdrop-filter: blur(10px);
}

.search-detail-item h4 {
  margin: 0 0 0.5rem 0;
  font-size: 0.9rem;
  opacity: 0.8;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.search-detail-item p {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
}

.results-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.results-count {
  color: var(--text-muted);
  font-size: 1.1rem;
}

.filter-controls {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 0.5rem 1rem;
  border: 2px solid var(--border-color);
  background: white;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.filter-btn:hover {
  border-color: var(--secondary-color);
  background: var(--secondary-color);
  color: white;
}

.filter-btn.active {
  background: var(--primary-color);
  border-color: var(--primary-color);
  color: white;
}

.aircraft-grid {
  display: grid;
  gap: 2rem;
  margin-bottom: 3rem;
}

.aircraft-card {
  background: white;
  border-radius: 15px;
  box-shadow: var(--shadow-light);
  overflow: hidden;
  transition: all 0.3s ease;
  border: 1px solid var(--border-color);
}

.aircraft-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-medium);
}

.aircraft-header {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 2rem;
  padding: 2rem;
  border-bottom: 1px solid var(--border-color);
}

.aircraft-info h3 {
  margin: 0 0 0.5rem 0;
  color: var(--primary-color);
  font-size: 1.5rem;
  font-weight: 700;
}

.aircraft-type {
  color: var(--text-muted);
  font-size: 1.1rem;
  margin-bottom: 1rem;
}

.aircraft-specs {
  display: flex;
  gap: 2rem;
  flex-wrap: wrap;
}

.spec-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-muted);
  font-size: 0.9rem;
}

.spec-icon {
  width: 16px;
  height: 16px;
  opacity: 0.7;
}

.pricing-info {
  text-align: right;
}

.price-main {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary-color);
  margin: 0;
}

.price-details {
  color: var(--text-muted);
  font-size: 0.9rem;
  margin-top: 0.5rem;
}

.aircraft-body {
  padding: 2rem;
}

.aircraft-features {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-bottom: 2rem;
}

.feature-group h4 {
  color: var(--primary-color);
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
  font-weight: 600;
}

.feature-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.feature-list li {
  padding: 0.5rem 0;
  color: var(--text-muted);
  border-bottom: 1px solid rgba(0,0,0,0.05);
}

.feature-list li:last-child {
  border-bottom: none;
}

.availability-status {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 500;
  margin-bottom: 1rem;
}

.status-available {
  background: rgba(39, 174, 96, 0.1);
  color: var(--success-color);
}

.status-limited {
  background: rgba(243, 156, 18, 0.1);
  color: var(--warning-color);
}

.aircraft-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 2rem;
}

.btn {
  padding: 0.75rem 2rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  font-size: 1rem;
}

.btn-primary {
  background: var(--secondary-color);
  color: white;
}

.btn-primary:hover {
  background: #2980b9;
  transform: translateY(-2px);
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--secondary-color);
  color: var(--secondary-color);
}

.btn-outline:hover {
  background: var(--secondary-color);
  color: white;
}

.no-results {
  text-align: center;
  padding: 4rem 2rem;
  background: white;
  border-radius: 15px;
  box-shadow: var(--shadow-light);
}

.no-results-icon {
  font-size: 4rem;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.no-results h3 {
  color: var(--primary-color);
  margin-bottom: 1rem;
}

.no-results p {
  color: var(--text-muted);
  max-width: 600px;
  margin: 0 auto 2rem;
  line-height: 1.6;
}

.modify-search-btn {
  background: var(--secondary-color);
  color: white;
  padding: 1rem 2rem;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.modify-search-btn:hover {
  background: #2980b9;
}

.trip-summary {
  background: var(--light-bg);
  padding: 1.5rem;
  border-radius: 10px;
  margin-bottom: 2rem;
}

.trip-route {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.route-airport {
  text-align: center;
  flex: 1;
}

.route-airport h4 {
  margin: 0;
  color: var(--primary-color);
  font-size: 1.2rem;
}

.route-airport p {
  margin: 0.5rem 0 0 0;
  color: var(--text-muted);
  font-size: 0.9rem;
}

.route-arrow {
  color: var(--secondary-color);
  font-size: 1.5rem;
  font-weight: bold;
}

@media (max-width: 768px) {
  .search-details {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .aircraft-header {
    grid-template-columns: 1fr;
    text-align: center;
  }
  
  .aircraft-features {
    grid-template-columns: 1fr;
  }
  
  .aircraft-specs {
    justify-content: center;
  }
  
  .results-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .filter-controls {
    justify-content: center;
  }
  
  .aircraft-actions {
    flex-direction: column;
  }
}
</style>

<br>
<br>
<br>
<br>
<br>



<div class="search-summary">
  <div class="search-details">
    <div class="search-detail-item">
      <h4>Route</h4>
      <p>{{ departure_airport.city }} → {{ arrival_airport.city }}</p>
    </div>
    <div class="search-detail-item">
      <h4>Departure</h4>
      <p>{{ departure_datetime|date:"M d, Y" }} at {{ departure_datetime|time:"H:i" }}</p>
    </div>
    {% if return_datetime %}
    <div class="search-detail-item">
      <h4>Return</h4>
      <p>{{ return_datetime|date:"M d, Y" }} at {{ return_datetime|time:"H:i" }}</p>
    </div>
    {% endif %}
    <div class="search-detail-item">
      <h4>Passengers</h4>
      <p>{{ passenger_count }} {{ passenger_count|pluralize:"passenger,passengers" }}</p>
    </div>
    <div class="search-detail-item">
      <h4>Trip Type</h4>
      <p>{{ trip_type|replace_underscore }}</p>
    </div>
  </div>
</div>

<div class="container">
  <div class="trip-summary">
    <div class="trip-route">
      <div class="route-airport">
        <h4>{{ departure_airport.icao_code }}</h4>
        <p>{{ departure_airport.name }}<br>{{ departure_airport.city }}, {{ departure_airport.country }}</p>
      </div>
     <div class="route-arrow">
        <i class="bi bi-airplane-fill" 
          style="font-size: 1.2em; 
                  color: inherit; 
                  transform: rotate(40deg) scaleX(0.9); 
                  display: inline-block;
                  transition: transform 0.3s ease;
                  margin-left: 2px;"></i>
      </div>
      <div class="route-airport">
        <h4>{{ arrival_airport.icao_code }}</h4>
        <p>{{ arrival_airport.name }}<br>{{ arrival_airport.city }}, {{ arrival_airport.country }}</p>
      </div>
    </div>
  </div>

  {% if aircraft_list %}
  <div class="results-header">
    <div class="results-count">
      <strong>{{ total_results }}</strong> aircraft available for your trip
    </div>
    <div class="filter-controls">
      <button class="filter-btn active" data-filter="all">All Aircraft</button>
      <button class="filter-btn" data-filter="jets">Jets</button>
      <button class="filter-btn" data-filter="turboprops">Turboprops</button>
      <button class="filter-btn" data-filter="price-low">Price: Low to High</button>
    </div>
  </div>

  <div class="aircraft-grid">
    {% for aircraft_info in aircraft_list %}
    <div class="aircraft-card" data-category="{{ aircraft_info.aircraft.aircraft_type.name|lower }}">
      <div class="aircraft-header">
        <div class="aircraft-info">
          <h3>{{ aircraft_info.aircraft.model_name }}</h3>
          <div class="aircraft-type">{{ aircraft_info.aircraft.aircraft_type.name }}</div>
          <div class="aircraft-specs">
            <div class="spec-item">
              <svg class="spec-icon" fill="currentColor" viewBox="0 0 20 20">
                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM5 8a2 2 0 11-4 0 2 2 0 014 0zM17 8a2 2 0 11-4 0 2 2 0 014 0z"/>
              </svg>
              <span>{{ aircraft_info.aircraft.aircraft_type.passenger_capacity }} seats</span>
            </div>
            <div class="spec-item">
              <svg class="spec-icon" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8 5a1 1 0 100 2h5.586l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L13.586 5H8zM12 15a1 1 0 100-2H6.414l1.293-1.293a1 1 0 10-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L6.414 15H12z"/>
              </svg>
              <span>{{ aircraft_info.aircraft.aircraft_type.range_nautical_miles|floatformat:0 }} nm range</span>
            </div>
            <div class="spec-item">
              <svg class="spec-icon" fill="currentColor" viewBox="0 0 20 20">
                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              </svg>
              <span>{{ aircraft_info.estimated_flight_hours }}h flight time</span>
            </div>
          </div>
        </div>
        <div class="pricing-info">
          <p class="price-main">${{ aircraft_info.total_price|floatformat:0 }}</p>
          <div class="price-details">
            ${{ aircraft_info.base_price|floatformat:0 }} base price<br>
            {% if trip_type == 'round_trip' %}× 2 for round trip{% endif %}
          </div>
        </div>
      </div>
      
      <div class="aircraft-body">
        <div class="availability-status {% if aircraft_info.availability_status == 'Available' %}status-available{% else %}status-limited{% endif %}">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
            <circle cx="6" cy="6" r="6"/>
          </svg>
          {{ aircraft_info.availability_status }}
        </div>

        <div class="aircraft-features">
          <div class="feature-group">
            <h4>Aircraft Details</h4>
            <ul class="feature-list">
              <li><strong>Registration:</strong> {{ aircraft_info.aircraft.registration_number }}</li>
              <li><strong>Year:</strong> {{ aircraft_info.aircraft.year_manufactured }}</li>
              <li><strong>Base Airport:</strong> {{ aircraft_info.aircraft.base_airport }}</li>
              <li><strong>Current Location:</strong> {{ aircraft_info.aircraft.current_location }}</li>
            </ul>
          </div>
          
          <div class="feature-group">
            <h4>Performance</h4>
            <ul class="feature-list">
              <li><strong>Cruising Speed:</strong> {{ aircraft_info.aircraft.aircraft_type.speed_knots }} knots</li>
              <li><strong>Maximum Range:</strong> {{ aircraft_info.aircraft.aircraft_type.range_nautical_miles }} nm</li>
              <li><strong>Hourly Rate:</strong> ${{ aircraft_info.aircraft.hourly_rate }}/hour</li>
              <li><strong>Minimum Hours:</strong> {{ aircraft_info.aircraft.minimum_hours }}h</li>
            </ul>
          </div>
        </div>

        {% if aircraft_info.aircraft.features %}
        <div class="feature-group">
          <h4>Special Features</h4>
          <p>{{ aircraft_info.aircraft.features }}</p>
        </div>
        {% endif %}

        <div class="aircraft-actions">
          <button class="btn btn-outline" onclick="showAircraftDetails('{{ aircraft_info.aircraft.id }}')">
            View Details
          </button>
          <button class="btn btn-primary" onclick="bookAircraft('{{ aircraft_info.aircraft.id }}')">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
            </svg>
            Book Now
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="no-results">
    <div class="no-results-icon">
      <i class="bi bi-airplane-fill" style="font-size: 2rem; color: #6c757d;"></i>
    </div>
    <h3>No Aircraft Available</h3>
    <p>
      We couldn't find any aircraft available for your requested route from 
      <strong>{{ departure_airport.name }}</strong> to <strong>{{ arrival_airport.name }}</strong> 
      on <strong>{{ departure_datetime|date:"F d, Y" }}</strong>.
    </p>
    <p>
      This might be due to high demand, aircraft positioning, or maintenance schedules. 
      Try adjusting your departure date or consider nearby airports.
    </p>
    <button class="modify-search-btn" onclick="history.back()">
      Modify Search
    </button>
  </div>
  {% endif %}
</div>

<!-- Booking Modal (placeholder) -->
<!-- Replace the existing booking modal placeholder with this enhanced version -->

<!-- Booking Modal -->
<div id="bookingModal" class="modal fade" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Complete Your Booking</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Loading State -->
        <div id="bookingLoader" class="text-center py-4" style="display: none;">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Processing your request...</p>
        </div>

        <!-- Selected Aircraft Summary -->
        <div id="selectedAircraftSummary" class="card mb-4" style="display: none;">
          <div class="card-header">
            <h6 class="mb-0">Selected Aircraft</h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p class="mb-1"><strong>Aircraft:</strong> <span id="selectedAircraftName"></span></p>
                <p class="mb-1"><strong>Type:</strong> <span id="selectedAircraftType"></span></p>
                <p class="mb-1"><strong>Registration:</strong> <span id="selectedAircraftReg"></span></p>
              </div>
              <div class="col-md-6">
                <p class="mb-1"><strong>Route:</strong> <span id="selectedRoute"></span></p>
                <p class="mb-1"><strong>Departure:</strong> <span id="selectedDeparture"></span></p>
                <p class="mb-1"><strong>Passengers:</strong> <span id="selectedPassengers"></span></p>
                <p class="mb-0"><strong>Total Price:</strong> <span id="selectedPrice" class="text-primary fw-bold"></span></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Booking Form -->
        <div id="bookingFormContainer" style="display: none;">
          <form id="bookingForm">
            <input type="hidden" id="selectedAircraftId" name="aircraft_id">
            <input type="hidden" name="departure_airport" value="{{ departure_airport.icao_code }}">
            <input type="hidden" name="arrival_airport" value="{{ arrival_airport.icao_code }}">
            <input type="hidden" name="departure_datetime" value="{{ departure_datetime|date:'Y-m-d H:i' }}">
            {% if return_datetime %}
            <input type="hidden" name="return_datetime" value="{{ return_datetime|date:'Y-m-d H:i' }}">
            {% endif %}
            <input type="hidden" name="trip_type" value="{{ trip_type }}">
            <input type="hidden" name="passenger_count" value="{{ passenger_count }}">

            <!-- Client Information -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="clientName" class="form-label">Full Name *</label>
                <input type="text" class="form-control" id="clientName" name="client_name" required>
              </div>
              <div class="col-md-6">
                <label for="clientEmail" class="form-label">Email Address *</label>
                <input type="email" class="form-control" id="clientEmail" name="client_email" required>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="clientPhone" class="form-label">Phone Number *</label>
                <input type="tel" class="form-control" id="clientPhone" name="client_phone" required>
              </div>
              <div class="col-md-6">
                <label for="companyName" class="form-label">Company Name (Optional)</label>
                <input type="text" class="form-control" id="companyName" name="company_name">
              </div>
            </div>

            <!-- Passenger Details -->
            <div class="card mb-3">
              <div class="card-header">
                <h6 class="mb-0">Passenger Information</h6>
              </div>
              <div class="card-body">
                <div id="passengerDetails">
                  <!-- Passenger fields will be dynamically generated here -->
                </div>
              </div>
            </div>

            <!-- Flight Preferences -->
            <div class="card mb-3">
              <div class="card-header">
                <h6 class="mb-0">Flight Preferences</h6>
              </div>
              <div class="card-body">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="departureTime" class="form-label">Preferred Departure Time</label>
                    <input type="time" class="form-control" id="departureTime" name="departure_time" value="{{ departure_datetime|time:'H:i' }}">
                  </div>
                  {% if trip_type == 'round_trip' %}
                  <div class="col-md-6">
                    <label for="returnTime" class="form-label">Preferred Return Time</label>
                    <input type="time" class="form-control" id="returnTime" name="return_time" value="{{ return_datetime|time:'H:i' }}">
                  </div>
                  {% endif %}
                </div>

                <div class="mb-3">
                  <label for="specialRequests" class="form-label">Special Requests / Dietary Requirements</label>
                  <textarea class="form-control" id="specialRequests" name="special_requests" rows="3" placeholder="Any special requests, dietary requirements, or additional services needed..."></textarea>
                </div>

                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="cateringRequired" name="catering_required">
                  <label class="form-check-label" for="cateringRequired">
                    In-flight catering required
                  </label>
                </div>

                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="groundTransport" name="ground_transport">
                  <label class="form-check-label" for="groundTransport">
                    Ground transportation assistance needed
                  </label>
                </div>
              </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="agreeTerms" name="agree_terms" required>
              <label class="form-check-label" for="agreeTerms">
                I agree to the <a href="#" target="_blank">Terms and Conditions</a> and <a href="#" target="_blank">Privacy Policy</a> *
              </label>
            </div>

            <!-- Price Summary -->
            <div class="card bg-light mb-3">
              <div class="card-body">
                <div class="row">
                  <div class="col-6">
                    <p class="mb-1">Base Price:</p>
                    <p class="mb-1">Trip Type:</p>
                    {% if trip_type == 'round_trip' %}
                    <p class="mb-1">Round Trip Multiplier:</p>
                    {% endif %}
                    <hr class="my-2">
                    <p class="mb-0 fw-bold">Total Amount:</p>
                  </div>
                  <div class="col-6 text-end">
                    <p class="mb-1">$<span id="basePriceDisplay">0</span></p>
                    <p class="mb-1 text-capitalize">{{ trip_type|replace_underscore }}</p>
                    {% if trip_type == 'round_trip' %}
                    <p class="mb-1">× 2</p>
                    {% endif %}
                    <hr class="my-2">
                    <p class="mb-0 fw-bold text-primary">$<span id="totalPriceDisplay">0</span></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary btn-lg" id="submitBookingBtn">
                <span class="btn-text">Submit Booking Request</span>
                <span class="btn-spinner" style="display: none;">
                  <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                  Processing...
                </span>
              </button>
              <small class="text-muted text-center">
                Your booking request will be reviewed and confirmed within 24 hours.
              </small>
            </div>
          </form>
        </div>

        <!-- Success Message -->
        <div id="bookingSuccess" class="text-center py-4" style="display: none;">
          <div class="mb-3">
            <svg width="64" height="64" fill="green" viewBox="0 0 16 16">
              <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.061L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
            </svg>
          </div>
          <h4>Booking Request Submitted!</h4>
          <p class="mb-3">Thank you for your booking request. We'll review your request and get back to you within 24 hours with confirmation and payment details.</p>
          <p><strong>Booking Reference:</strong> <span id="bookingReference"></span></p>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
        </div>

        <!-- Error Message -->
        <div id="bookingError" class="alert alert-danger" style="display: none;">
          <h6>Booking Error</h6>
          <p id="errorMessage"></p>
          <button type="button" class="btn btn-outline-danger btn-sm" onclick="retryBooking()">Try Again</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal fade" tabindex="-1" data-bs-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Login Required</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">Please log in to continue with your booking.</p>
        
        <form id="loginForm">
          <div class="mb-3">
            <label for="loginEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="loginEmail" name="email" required>
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">Password</label>
            <input type="password" class="form-control" id="loginPassword" name="password" required>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="rememberMe" name="remember_me">
            <label class="form-check-label" for="rememberMe">Remember me</label>
          </div>
          
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary" id="loginSubmitBtn">
              <span class="btn-text">Login</span>
              <span class="btn-spinner" style="display: none;">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Logging in...
              </span>
            </button>
          </div>
        </form>
        
        <hr>
        <div class="text-center">
          <p class="mb-2">Don't have an account?</p>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="showSignupModal()">
            Create Account
          </button>
          <br>
          <a href="#" class="small">Forgot Password?</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Signup Modal -->
<div id="signupModal" class="modal fade" tabindex="-1" data-bs-backdrop="static">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Create Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3 text-muted">Join us to book your private jet charter flights.</p>
        
        <form id="signupForm">
          <div class="row">
            <!-- Personal Information -->
            <div class="col-md-6">
              <h6 class="border-bottom pb-2 mb-3">Personal Information</h6>
              
              <div class="mb-3">
                <label for="signupFirstName" class="form-label">First Name *</label>
                <input type="text" class="form-control" id="signupFirstName" name="first_name" required>
              </div>
              
              <div class="mb-3">
                <label for="signupLastName" class="form-label">Last Name *</label>
                <input type="text" class="form-control" id="signupLastName" name="last_name" required>
              </div>
              
              <div class="mb-3">
                <label for="signupEmail" class="form-label">Email Address *</label>
                <input type="email" class="form-control" id="signupEmail" name="email" required>
                <div class="form-text">We'll send booking confirmations to this email.</div>
              </div>
              
              <div class="mb-3">
                <label for="signupPhone" class="form-label">Phone Number *</label>
                <input type="tel" class="form-control" id="signupPhone" name="phone_number" required>
              </div>
              
              <div class="mb-3">
                <label for="signupUserType" class="form-label">Account Type *</label>
                <select class="form-select" id="signupUserType" name="user_type" required>
                  <option value="">Select account type</option>
                  <option value="client">Client (Book flights)</option>
                  <option value="owner">Aircraft Owner</option>
                  <option value="agent">Booking Agent</option>
                </select>
              </div>
            </div>
            
            <!-- Account & Additional Info -->
            <div class="col-md-6">
              <h6 class="border-bottom pb-2 mb-3">Account Details</h6>
              
              <div class="mb-3">
                <label for="signupUsername" class="form-label">Username *</label>
                <input type="text" class="form-control" id="signupUsername" name="username" required>
                <div class="form-text">Choose a unique username for your account.</div>
              </div>
              
              <div class="mb-3">
                <label for="signupPassword" class="form-label">Password *</label>
                <input type="password" class="form-control" id="signupPassword" name="password1" required>
                <div class="form-text">
                  <small>Password must be at least 8 characters long.</small>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="signupPassword2" class="form-label">Confirm Password *</label>
                <input type="password" class="form-control" id="signupPassword2" name="password2" required>
              </div>
              
              <div class="mb-3">
                <label for="signupAddress" class="form-label">Address</label>
                <textarea class="form-control" id="signupAddress" name="address" rows="3" placeholder="Street, City, State, Country"></textarea>
              </div>
              
              <!-- Company Info (conditional) -->
              <div id="companyFields" style="display: none;">
                <div class="mb-3">
                  <label for="signupCompany" class="form-label">Company Name</label>
                  <input type="text" class="form-control" id="signupCompany" name="company_name">
                </div>
                
                <div class="mb-3">
                  <label for="signupTaxId" class="form-label">Tax ID</label>
                  <input type="text" class="form-control" id="signupTaxId" name="tax_id">
                </div>
              </div>
            </div>
          </div>
          
          <!-- Terms & Conditions -->
          <div class="row mt-3">
            <div class="col-12">
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="agreeTerms" name="agree_terms" required>
                <label class="form-check-label" for="agreeTerms">
                  I agree to the <a href="#" target="_blank">Terms of Service</a> and <a href="#" target="_blank">Privacy Policy</a> *
                </label>
              </div>
              
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="marketingEmails" name="marketing_emails">
                <label class="form-check-label" for="marketingEmails">
                  I would like to receive promotional emails and flight deals
                </label>
              </div>
            </div>
          </div>
          
          <!-- Error Display -->
          <div id="signupError" class="alert alert-danger" style="display: none;">
            <ul id="signupErrorList" class="mb-0"></ul>
          </div>
          
          <!-- Submit Button -->
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg" id="signupSubmitBtn">
              <span class="btn-text">Create Account</span>
              <span class="btn-spinner" style="display: none;">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Creating Account...
              </span>
            </button>
          </div>
        </form>
        
        <hr>
        <div class="text-center">
          <p class="mb-0">Already have an account? 
            <button type="button" class="btn btn-link p-0" onclick="showLoginModal()">Login here</button>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.modal-lg {
  max-width: 800px;
}

.card {
  border: 1px solid #dee2e6;
  border-radius: 0.5rem;
}

.card-header {
  background-color: #f8f9fa;
  border-bottom: 1px solid #dee2e6;
  padding: 0.75rem 1rem;
}

.card-header h6 {
  color: #495057;
  font-weight: 600;
}

.btn-spinner {
  display: inline-flex;
  align-items: center;
}

.passenger-group {
  border: 1px solid #e9ecef;
  border-radius: 0.375rem;
  padding: 1rem;
  margin-bottom: 1rem;
  background-color: #f8f9fa;
}

.passenger-group h6 {
  color: #495057;
  margin-bottom: 0.75rem;
}

#bookingError {
  margin-top: 1rem;
}

.form-control:focus {
  border-color: #80bdff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.text-primary {
  color: #0d6efd !important;
}

.bg-light {
  background-color: #f8f9fa !important;
}

/* Additional styles for signup modal */
#signupModal .modal-dialog {
  max-width: 900px;
}

#signupModal .form-label {
  font-weight: 500;
  color: #495057;
}

#signupModal .border-bottom {
  border-color: #dee2e6 !important;
}

#signupModal .form-text {
  font-size: 0.875rem;
  color: #6c757d;
}

#signupModal .btn-link {
  color: #0d6efd;
  text-decoration: none;
}

#signupModal .btn-link:hover {
  text-decoration: underline;
}

.password-strength {
  margin-top: 0.25rem;
}

.password-strength .strength-bar {
  height: 4px;
  background-color: #e9ecef;
  border-radius: 2px;
  overflow: hidden;
}

.password-strength .strength-fill {
  height: 100%;
  transition: width 0.3s ease, background-color 0.3s ease;
}

.strength-weak { background-color: #dc3545; }
.strength-medium { background-color: #ffc107; }
.strength-strong { background-color: #28a745; }
</style>

<script>
// Global variables
let selectedAircraftData = null;
let pendingBookingData = null;

// Function to open booking modal
function bookAircraft(aircraftId) {
    // Find the aircraft in the list
    const aircraftCards = document.querySelectorAll('.aircraft-card');
    let aircraftInfo = null;
    
    aircraftCards.forEach(card => {
        const bookBtn = card.querySelector(`button[onclick="bookAircraft('${aircraftId}')"]`);
        if (bookBtn) {
            // Extract aircraft data from the card
            aircraftInfo = {
                id: aircraftId,
                name: card.querySelector('h3').textContent,
                type: card.querySelector('.aircraft-type').textContent,
                registration: card.querySelector('.feature-list li:first-child').textContent.split(': ')[1],
                totalPrice: card.querySelector('.price-main').textContent.replace('$', '').replace(',', ''),
                basePrice: card.querySelector('.price-details').textContent.split('$')[1].split(' ')[0]
            };
        }
    });
    
    if (!aircraftInfo) {
        alert('Aircraft information not found. Please try again.');
        return;
    }
    
    selectedAircraftData = aircraftInfo;
    
    // Check if user is authenticated
    checkAuthenticationAndProceed();
}

// Check if user is authenticated
function checkAuthenticationAndProceed() {
    fetch('/api/check-auth/')  // You'll need to create this endpoint
        .then(response => response.json())
        .then(data => {
            if (data.authenticated) {
                // User is logged in, proceed with booking
                openBookingModal();
            } else {
                // User needs to log in
                openLoginModal();
            }
        })
        .catch(error => {
            console.error('Auth check error:', error);
            // Assume not authenticated on error
            openLoginModal();
        });
}

// Open login modal
function openLoginModal() {
    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
    loginModal.show();
}

// Open booking modal
function openBookingModal() {
    // Populate aircraft summary
    document.getElementById('selectedAircraftName').textContent = selectedAircraftData.name;
    document.getElementById('selectedAircraftType').textContent = selectedAircraftData.type;
    document.getElementById('selectedAircraftReg').textContent = selectedAircraftData.registration;
    document.getElementById('selectedRoute').textContent = '{{ departure_airport.city }} → {{ arrival_airport.city }}';
    document.getElementById('selectedDeparture').textContent = '{{ departure_datetime|date:"M d, Y H:i" }}';
    document.getElementById('selectedPassengers').textContent = '{{ passenger_count }} {{ passenger_count|pluralize:"passenger,passengers" }}';
    document.getElementById('selectedPrice').textContent = '$' + selectedAircraftData.totalPrice;
    
    // Set form values
    document.getElementById('selectedAircraftId').value = selectedAircraftData.id;
    document.getElementById('basePriceDisplay').textContent = selectedAircraftData.basePrice;
    document.getElementById('totalPriceDisplay').textContent = selectedAircraftData.totalPrice;
    
    // Generate passenger detail fields
    generatePassengerFields();
    
    // Show modal sections
    document.getElementById('selectedAircraftSummary').style.display = 'block';
    document.getElementById('bookingFormContainer').style.display = 'block';
    document.getElementById('bookingSuccess').style.display = 'none';
    document.getElementById('bookingError').style.display = 'none';
    
    // Open modal
    const bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
    bookingModal.show();
}

// Generate passenger detail fields
function generatePassengerFields() {
    const passengerCount = {{ passenger_count }};
    const container = document.getElementById('passengerDetails');
    container.innerHTML = '';
    
    for (let i = 1; i <= passengerCount; i++) {
        const passengerGroup = document.createElement('div');
        passengerGroup.className = 'passenger-group';
        passengerGroup.innerHTML = `
            <h6>Passenger ${i}</h6>
            <div class="row">
                <div class="col-md-6 mb-2">
                    <label class="form-label">Full Name *</label>
                    <input type="text" class="form-control" name="passenger_${i}_name" required>
                </div>
                <div class="col-md-6 mb-2">
                    <label class="form-label">Date of Birth</label>
                    <input type="date" class="form-control" name="passenger_${i}_dob">
                </div>
                <div class="col-md-6 mb-2">
                    <label class="form-label">Passport Number</label>
                    <input type="text" class="form-control" name="passenger_${i}_passport">
                </div>
                <div class="col-md-6 mb-2">
                    <label class="form-label">Nationality</label>
                    <input type="text" class="form-control" name="passenger_${i}_nationality">
                </div>
            </div>
        `;
        container.appendChild(passengerGroup);
    }
}

// Handle login form submission
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('loginSubmitBtn');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnSpinner = submitBtn.querySelector('.btn-spinner');
    
    // Show loading state
    btnText.style.display = 'none';
    btnSpinner.style.display = 'inline-flex';
    submitBtn.disabled = true;
    
    const formData = new FormData(this);
    
    fetch('/api/login/', {  // You'll need to create this endpoint
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Close login modal and open booking modal
            bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
            setTimeout(() => {
                openBookingModal();
            }, 300);
        } else {
            alert('Login failed: ' + (data.message || 'Invalid credentials'));
        }
    })
    .catch(error => {
        console.error('Login error:', error);
        alert('Login failed. Please try again.');
    })
    .finally(() => {
        // Reset button state
        btnText.style.display = 'inline';
        btnSpinner.style.display = 'none';
        submitBtn.disabled = false;
    });
});

// Handle booking form submission
document.getElementById('bookingForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submitBookingBtn');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnSpinner = submitBtn.querySelector('.btn-spinner');
    
    // Show loading state
    btnText.style.display = 'none';
    btnSpinner.style.display = 'inline-flex';
    submitBtn.disabled = true;
    
    const formData = new FormData(this);
    
    fetch('/api/create-booking/', {  // You'll need to create this endpoint
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            document.getElementById('bookingFormContainer').style.display = 'none';
            document.getElementById('bookingReference').textContent = data.booking_reference;
            document.getElementById('bookingSuccess').style.display = 'block';
        } else {
            // Show error message
            document.getElementById('errorMessage').textContent = data.message || 'An error occurred while processing your booking.';
            document.getElementById('bookingError').style.display = 'block';
        }
    })
    .catch(error => {
        console.error('Booking error:', error);
        document.getElementById('errorMessage').textContent = 'Network error. Please check your connection and try again.';
        document.getElementById('bookingError').style.display = 'block';
    })
    .finally(() => {
        // Reset button state
        btnText.style.display = 'inline';
        btnSpinner.style.display = 'none';
        submitBtn.disabled = false;
    });
});

// Retry booking function
function retryBooking() {
    document.getElementById('bookingError').style.display = 'none';
    document.getElementById('bookingFormContainer').style.display = 'block';
}

// Get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Optional: Show signup modal function (implement as needed)
// Show/hide company fields based on user type
document.getElementById('signupUserType').addEventListener('change', function() {
    const companyFields = document.getElementById('companyFields');
    const userType = this.value;
    
    if (userType === 'owner' || userType === 'agent') {
        companyFields.style.display = 'block';
        // Make company fields required for these user types
        document.getElementById('signupCompany').required = true;
    } else {
        companyFields.style.display = 'none';
        document.getElementById('signupCompany').required = false;
        // Clear values when hidden
        document.getElementById('signupCompany').value = '';
        document.getElementById('signupTaxId').value = '';
    }
});

// Password strength indicator
document.getElementById('signupPassword').addEventListener('input', function() {
    const password = this.value;
    let strength = 0;
    
    // Check password criteria
    if (password.length >= 8) strength++;
    if (/[a-z]/.test(password)) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;
    
    // Create or update strength indicator
    let strengthDiv = document.querySelector('.password-strength');
    if (!strengthDiv) {
        strengthDiv = document.createElement('div');
        strengthDiv.className = 'password-strength';
        strengthDiv.innerHTML = `
            <div class="strength-bar">
                <div class="strength-fill"></div>
            </div>
            <small class="strength-text"></small>
        `;
        this.parentNode.appendChild(strengthDiv);
    }
    
    const strengthFill = strengthDiv.querySelector('.strength-fill');
    const strengthText = strengthDiv.querySelector('.strength-text');
    
    if (password.length === 0) {
        strengthDiv.style.display = 'none';
        return;
    }
    
    strengthDiv.style.display = 'block';
    
    switch (strength) {
        case 0:
        case 1:
        case 2:
            strengthFill.style.width = '33%';
            strengthFill.className = 'strength-fill strength-weak';
            strengthText.textContent = 'Weak password';
            strengthText.style.color = '#dc3545';
            break;
        case 3:
        case 4:
            strengthFill.style.width = '66%';
            strengthFill.className = 'strength-fill strength-medium';
            strengthText.textContent = 'Medium password';
            strengthText.style.color = '#ffc107';
            break;
        case 5:
            strengthFill.style.width = '100%';
            strengthFill.className = 'strength-fill strength-strong';
            strengthText.textContent = 'Strong password';
            strengthText.style.color = '#28a745';
            break;
    }
});

// Password confirmation validation
document.getElementById('signupPassword2').addEventListener('input', function() {
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = this.value;
    
    if (confirmPassword && password !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
        this.classList.add('is-invalid');
    } else {
        this.setCustomValidity('');
        this.classList.remove('is-invalid');
    }
});

// Handle signup form submission
document.getElementById('signupForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('signupSubmitBtn');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnSpinner = submitBtn.querySelector('.btn-spinner');
    const errorDiv = document.getElementById('signupError');
    const errorList = document.getElementById('signupErrorList');
    
    // Hide previous errors
    errorDiv.style.display = 'none';
    
    // Check password confirmation
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupPassword2').value;
    
    if (password !== confirmPassword) {
        errorList.innerHTML = '<li>Passwords do not match</li>';
        errorDiv.style.display = 'block';
        return;
    }
    
    // Show loading state
    btnText.style.display = 'none';
    btnSpinner.style.display = 'inline-flex';
    submitBtn.disabled = true;
    
    const formData = new FormData(this);
    
    fetch('/api/signup/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message and close modal
            alert('Account created successfully! You can now login.');
            bootstrap.Modal.getInstance(document.getElementById('signupModal')).hide();
            
            // Clear form
            document.getElementById('signupForm').reset();
            
            // Optionally auto-login or show login modal
            setTimeout(() => {
                openLoginModal();
            }, 500);
        } else {
            // Show validation errors
            errorList.innerHTML = '';
            
            if (data.errors) {
                // Handle field-specific errors
                Object.keys(data.errors).forEach(field => {
                    data.errors[field].forEach(error => {
                        const li = document.createElement('li');
                        li.textContent = `${field.replace('_', ' ')}: ${error}`;
                        errorList.appendChild(li);
                    });
                });
            } else if (data.message) {
                const li = document.createElement('li');
                li.textContent = data.message;
                errorList.appendChild(li);
            }
            
            errorDiv.style.display = 'block';
        }
    })
    .catch(error => {
        console.error('Signup error:', error);
        errorList.innerHTML = '<li>Network error. Please check your connection and try again.</li>';
        errorDiv.style.display = 'block';
    })
    .finally(() => {
        // Reset button state
        btnText.style.display = 'inline';
        btnSpinner.style.display = 'none';
        submitBtn.disabled = false;
    });
});

// Show signup modal function
function showSignupModal() {
    // Hide login modal if it's open
    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
    if (loginModal) {
        loginModal.hide();
    }
    
    // Show signup modal
    setTimeout(() => {
        const signupModal = new bootstrap.Modal(document.getElementById('signupModal'));
        signupModal.show();
    }, 300);
}

// Show login modal function (for switching back)
function showLoginModal() {
    // Hide signup modal if it's open
    const signupModal = bootstrap.Modal.getInstance(document.getElementById('signupModal'));
    if (signupModal) {
        signupModal.hide();
    }
    
    // Show login modal
    setTimeout(() => {
        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
        loginModal.show();
    }, 300);
}

// Username availability check (optional)
let usernameTimeout;
document.getElementById('signupUsername').addEventListener('input', function() {
    const username = this.value.trim();
    const inputField = this;
    
    if (username.length < 3) return;
    
    clearTimeout(usernameTimeout);
    usernameTimeout = setTimeout(() => {
        fetch(`/api/check-username/?username=${encodeURIComponent(username)}`)
            .then(response => response.json())
            .then(data => {
                if (data.available) {
                    inputField.classList.remove('is-invalid');
                    inputField.classList.add('is-valid');
                } else {
                    inputField.classList.remove('is-valid');
                    inputField.classList.add('is-invalid');
                }
            })
            .catch(error => {
                console.error('Username check error:', error);
            });
    }, 500);
});

// Email availability check (optional)
let emailTimeout;
document.getElementById('signupEmail').addEventListener('blur', function() {
    const email = this.value.trim();
    const inputField = this;
    
    if (!email || !email.includes('@')) return;
    
    clearTimeout(emailTimeout);
    emailTimeout = setTimeout(() => {
        fetch(`/api/check-email/?email=${encodeURIComponent(email)}`)
            .then(response => response.json())
            .then(data => {
                if (data.available) {
                    inputField.classList.remove('is-invalid');
                } else {
                    inputField.classList.add('is-invalid');
                    inputField.setCustomValidity('This email is already registered');
                }
            })
            .catch(error => {
                console.error('Email check error:', error);
            });
    }, 500);
});
</script>
{% endblock %}

{% block extra_js %}
<script>
// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const filterBtns = document.querySelectorAll('.filter-btn');
  const aircraftCards = document.querySelectorAll('.aircraft-card');
  
  filterBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      // Remove active class from all buttons
      filterBtns.forEach(b => b.classList.remove('active'));
      // Add active class to clicked button
      this.classList.add('active');
      
      const filter = this.dataset.filter;
      
      aircraftCards.forEach(card => {
        if (filter === 'all') {
          card.style.display = 'block';
        } else if (filter === 'jets') {
          const category = card.dataset.category;
          card.style.display = category.includes('jet') ? 'block' : 'none';
        } else if (filter === 'turboprops') {
          const category = card.dataset.category;
          card.style.display = category.includes('turboprop') ? 'block' : 'none';
        } else if (filter === 'price-low') {
          // Sort by price (simplified - in real app, you'd re-query)
          const container = document.querySelector('.aircraft-grid');
          const cards = Array.from(aircraftCards);
          cards.sort((a, b) => {
            const priceA = parseFloat(a.querySelector('.price-main').textContent.replace(/[$,]/g, ''));
            const priceB = parseFloat(b.querySelector('.price-main').textContent.replace(/[$,]/g, ''));
            return priceA - priceB;
          });
          cards.forEach(card => container.appendChild(card));
        }
      });
    });
  });
});

function showAircraftDetails(aircraftId) {
  // Implement aircraft details modal or page
  console.log('Show details for aircraft:', aircraftId);
  // You can implement this to show more details, images, etc.
}

function bookAircraft(aircraftId) {
  // Implement booking flow
  console.log('Book aircraft:', aircraftId);
  
  // Create booking form data
  const bookingData = {
    aircraft_id: aircraftId,
    departure_airport: '{{ departure_airport.icao_code }}',
    arrival_airport: '{{ arrival_airport.icao_code }}',
    departure_datetime: '{{ departure_datetime|date:"c" }}',
    {% if return_datetime %}return_datetime: '{{ return_datetime|date:"c" }}',{% endif %}
    passenger_count: {{ passenger_count }},
    trip_type: '{{ trip_type }}',
    client_name: '{{ client_name }}',
    client_email: '{{ client_email }}',
    special_requests: '{{ special_requests }}'
  };
  
  // You can redirect to booking page or show booking modal
  // For now, let's redirect to a booking page with parameters
  const params = new URLSearchParams(bookingData);
  window.location.href = `/book-aircraft/?${params.toString()}`;
}

// Smooth scroll to top when filtering
function scrollToTop() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}
</script>
{% endblock %}
{% comment %}

{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="card border-0 shadow">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Available Aircraft</h4>
          <small>From {{ departure_airport.icao_code }} to {{ arrival_airport.icao_code }} on {{ departure_datetime|date:"M d, Y H:i" }}</small>
        </div>
        
        <div class="card-body">
          {% if aircraft_list %}
            <div class="list-group">
              {% for aircraft in aircraft_list %}
              <div class="list-group-item list-group-item-action mb-3 rounded">
                <div class="row align-items-center">
                  <div class="col-md-3">
                    {% if aircraft.interior_images.first %}
                    <img src="{{ aircraft.interior_images.first.image.url }}" 
                         class="img-fluid rounded" 
                         alt="{{ aircraft.model_name }}">
                    {% else %}
                    <div class="bg-light rounded" style="height: 100px; width: 100%;"></div>
                    {% endif %}
                  </div>
                  
                  <div class="col-md-6">
                    <h5>{{ aircraft.model_name }}</h5>
                    <p class="mb-1">
                      <i class="fas fa-users"></i> {{ aircraft.aircraft_type.passenger_capacity }} passengers<br>
                      <i class="fas fa-plane"></i> {{ aircraft.registration_number }}<br>
                      <i class="fas fa-clock"></i> {{ aircraft.minimum_hours }}h minimum
                    </p>
                    <p class="text-muted small">{{ aircraft.aircraft_type.description }}</p>
                  </div>
                  
                  <div class="col-md-3 text-end">
                    <h5>${{ aircraft.hourly_rate|floatformat:2 }}/hour</h5>
                    <form method="post" action="{% url 'create_booking' %}">
                      {% csrf_token %}
                      <input type="hidden" name="aircraft_id" value="{{ aircraft.id }}">
                      <input type="hidden" name="departure_icao" value="{{ departure_airport.icao_code }}">
                      <input type="hidden" name="arrival_icao" value="{{ arrival_airport.icao_code }}">
                      <input type="hidden" name="departure_datetime" value="{{ departure_datetime|date:'c' }}">
                      <input type="hidden" name="passenger_count" value="{{ passenger_count }}">
                      <input type="hidden" name="trip_type" value="{{ trip_type }}">
                      <input type="hidden" name="client_email" value="{{ client_email }}">
                      <input type="hidden" name="client_name" value="{{ client_name }}">
                      <input type="hidden" name="special_requests" value="{{ special_requests }}">
                      <button type="submit" class="btn btn-primary btn-sm">Select</button>
                    </form>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="alert alert-warning">
              No aircraft available matching your criteria. Please try different dates or airports.
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% endcomment %}